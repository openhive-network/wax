<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proto Sign Transaction Example</title>
</head>
<body>
  <script type="module">
    // If you are not using any bundler in your project define the source map before importing @hive/wax or @hive/beekeeper (We use `parcel`. See index.ts#open)
    import * as WaxModule from '@hive/wax';
    import beekeeperFactory from '@hive/beekeeper';

    const protoTx = WaxModule.transaction.create({
      ref_block_num: 19260,
      ref_block_prefix: 2140466769,
      expiration: "2016-09-15T19:47:33",
      operations: [
        {
          vote: {
            voter: "taoteh1221",
            author: "ozchartart",
            permlink: "usdsteem-btc-daily-poloniex-bittrex-technical-analysis-market-report-update-46-glass-half-full-but-the-bottle-s-left-empty-sept",
            weight: 10000
          }
        }
      ],
      extensions: []
    });

    const OUR_MAINNET_INITMINER_PRIVATE_KEY_DO_NOT_SHARE = "5JNHfZYKGaomSFvd4NUdQ9qMcEAC43kujbfjueTHpVapX1Kzq2n"; // :)
    const walletName = "pear";

    (async() => {
      const waxProvider = await WaxModule.default();
      const beekeeper = await beekeeperFactory();

      const proto = new waxProvider.proto_protocol();

      // We have to transform our API to the plain object first and then stringify it so it can be sent to wasm
      const { content: sigDigest } = proto.cpp_calculate_sig_digest(JSON.stringify(WaxModule.transaction.toJSON(protoTx)), "42");

      const session = await beekeeper.createSession('pear');

      const { wallet } = await session.createWallet(walletName);
      await wallet.importKey(OUR_MAINNET_INITMINER_PRIVATE_KEY_DO_NOT_SHARE);

      const [ publicKey ] = await wallet.getPublicKeys();

      const signature = await wallet.signDigest(publicKey, sigDigest);

      console.log(`Your signature for transmitting: "${signature}"`);

      await beekeeper.delete();

      window.exampleFinished = true; // Optional - just for our test purposes
    })();
  </script>
</body>
</html>
